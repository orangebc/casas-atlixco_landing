jQuery.validator.addMethod("expression", function(value, element, param) {
    return value.match(new RegExp("^" + param + "$"));
});
$(function () {
	$("#telefono").keypress(function (e) {
		if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57) && e.which != 13) {
			return false;
		}
	});

	$("#step1").validate({
		rules: {
			nombre: {
				required: true,
				expression: "[a-zA-Z Ññáéíóú]+"
			},
			telefono: {
				required: true,
				digits: true
			},
			email: {
			   required: true,
			   email: true
		    }
        },
		messages: {
			nombre: {
				required: "Por favor escribe tu nombre",
				expression: "Solo permite escribir letras"
			},
			telefono: {
				required: "Por favor escribe tu número de teléfono",
				digits: "Solo permite ingresar números",
				minlength: "El telefono debe contener 10 dígitos (clave lada + número telefónico)"
			},
			email: {
			   required: "Por favor escribe tu correo electrónico",
			   email: "Solo permite ingresar correos electrónicos validos"
		    }
		},
		debug: true,
		onfocusout:false,
		onkeyup:false,
		onclick:false,
		submitHandler: function(form) {
				checkForm(form);
		},
		errorPlacement: function (error, element) {
		},
		showErrors: function(errorMap, errorList){
			this.defaultShowErrors();
			if(errorList.length) {
				alert(errorList[0].message);
			}
		}
	});
});

function checkForm(form){
	var formID ="#step1";
	var formURL = "php/step1.php";
	var formData = $(formID).serialize();
	$.post(formURL, formData, function(data){
		if(data.message=="success"){
			alert('Gracias, en breve nos comunicaremos con usted.');
			$("#step1").fadeOut(2000);
			$("#conv").html(data.conv);
		}
		return false;
	},"json");
}